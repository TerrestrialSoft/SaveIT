@page "/"
@page "/games"
@using SaveIt.App.Domain.Repositories
@using SaveIt.App.Domain.Entities
@inject IGameRepository gameRepository
@inject IStorageAccountRepository storageAccountRepository

<div class="d-flex m-3 justify-content-center">
    <SearchBar OnSearch="UpdateGames" />
    <Button Color="ButtonColor.Primary" Size="Size.Large" Class="p-2 ms-5" @onclick="ShowCreateNewGameModal">
        <Icon Name="IconName.PlusLg" /> Create new Game
    </Button>
</div>

<div class="d-flex flex-wrap">
    @foreach (var game in _filteredGames)
    {
        <GameCard Game="game" ShowDetail="game == _selectedGame" OnCardClicked="GameCardClicked" />
    }
</div>

<Modal @ref="_createNewGameModal" Title="Modal title" Size="ModalSize.ExtraLarge" IsVerticallyCentered="true">
    <BodyTemplate>
        <EditForm Model="_selectedGame">
            <div class="d-flex">
                <div>
                    <div>
                        <label>
                            Game Name
                            <InputText @bind-Value="_selectedGame.Name" />
                        </label>
                    </div>
                    <div>
                        <label>
                            Username
                            <InputText @bind-Value="_selectedGame.Name" />
                        </label>
                    </div>
                </div>
                <div>
                    <div>
                        <ImagePicker />
                    </div>
                    <div>
                    
                    </div>
                </div>
            </div>
            
            <h3>Game Save Information</h3>

            <div class="d-flex">
                <div>
                    <div>
                        <label>
                            Game Save Name
                            <InputText @bind-Value="_selectedGame.Name" />
                        </label>
                    </div>
                    <div>
                        <label>
                            Storage Account
                            <InputSelect @bind-Value="_selectedStorageAccount">
                                @foreach(var account in _storageAccounts)
                                {
                                    <option value="@account">@account.Email (@account.Type.ToString())</option>
                                }
                            </InputSelect>
                            <div>
                                or <b @onclick="ShowAuthorizeStorageModal">create a new one</b>.
                            </div>
                        </label>
                    </div>
                </div>
                <div>
                    <div>
                        <LocalFolderPicker Path="@_selectedLocalFolderPath" OnPickerClicked="ShowLocalFolderPickerModal" />
                    </div>
                </div>
            </div>
            
        </EditForm>
    </BodyTemplate>
    <FooterTemplate>
        <Button Color="ButtonColor.Primary">Save changes</Button>
    </FooterTemplate>
</Modal>

<Modal @ref="_localFolderPickerModal" Size="ModalSize.ExtraLarge" OnHidden="ShowCreateNewGameModal" IsVerticallyCentered="true" />
<Modal @ref="_authorizeStorageModal" Size="ModalSize.Large" OnHidden="ShowCreateNewGameModal" IsVerticallyCentered="true" />
